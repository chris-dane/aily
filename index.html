<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Critique</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style> body { padding-bottom: 40px; } </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <main class="mx-auto max-w-3xl p-4 space-y-6">
    <header class="pt-2">
      <h1 class="text-3xl font-bold">AI Critique</h1>
      <p class="text-sm text-gray-600 mt-1">Read, pick any weaknesses you see, then compare with our AI evaluator.</p>
    </header>

    <!-- Play -->
    <section id="play" class="rounded-2xl border bg-white p-4 shadow-sm">
      <h2 id="question" class="text-lg font-semibold"></h2>
      <blockquote id="answer" class="mt-2 rounded-2xl bg-gray-50 p-4 italic"></blockquote>

      <form id="choices" class="mt-2 space-y-2"></form>

      <div class="mt-4">
        <button id="submitBtn" class="rounded-xl bg-black px-4 py-2 text-sm text-white disabled:opacity-40" disabled>Submit</button>
      </div>
    </section>

    <!-- Results -->
    <section id="results" class="hidden rounded-2xl border bg-white p-4 shadow-sm space-y-4">
      <h3 class="text-lg font-semibold">Results</h3>

      <div class="overflow-x-auto">
        <table class="w-full text-sm border border-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left p-2 border-b">Weakness</th>
              <th class="text-center p-2 border-b">You</th>
              <th class="text-center p-2 border-b">Evaluator</th>
            </tr>
          </thead>
          <tbody id="resultsTable"></tbody>
        </table>
      </div>

      <div class="rounded-xl border p-3 bg-gray-50">
        <div class="text-sm font-medium">Evaluator summary</div>
        <div id="reasonLine" class="mt-1 text-sm"></div>
      </div>
    </section>

    <div class="text-[10px] text-gray-400 mt-6">
      We use one AI model such as ChatGPT to generate an answer, then use another model such as Claude to evaluate the answer against specific criteria. It’s an experimental concept to help encourage critical thinking when using AI. May contain mistakes.
    </div>
  </main>

  <script>
  // Tight backend labels (fixed order for UI) → user-facing descriptions
  const LABEL_ORDER = [
    "Factual error",
    "Omission",
    "Bias / overconfidence",
    "Outdated",
    "Off-topic"
  ];
  const LABEL_DESCRIPTIONS = {
    "Factual error": "Contains a false or made-up claim.",
    "Omission": "Leaves out key information.",
    "Bias / overconfidence": "Shows bias, overconfidence, or unfounded assumptions.",
    "Outdated": "Relies on old or no-longer-true information.",
    "Off-topic": "Doesn’t directly answer the question."
  };

  async function loadCase() {
    const res = await fetch("content.json?d=" + Date.now());
    const data = await res.json();

    // Populate Q & A
    document.getElementById('question').textContent = data.question;
    document.getElementById('answer').textContent = data.ai_output;

    // Build checkbox list (store tight keys, show descriptions)
    const form = document.getElementById('choices');
    form.innerHTML = "";
    const selected = new Set();

    LABEL_ORDER.forEach((key, idx) => {
      const id = 'opt_' + idx;
      const wrap = document.createElement('div');
      wrap.className = 'flex items-start gap-2';

      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.id = id; cb.value = key;
      cb.className = 'mt-0.5 h-4 w-4 rounded border-gray-300 text-black focus:ring-black';
      cb.addEventListener('change', () => {
        if (cb.checked) selected.add(key); else selected.delete(key);
        document.getElementById('submitBtn').disabled = selected.size === 0;
      });

      const lab = document.createElement('label');
      lab.setAttribute('for', id);
      lab.className = 'text-sm';
      lab.textContent = LABEL_DESCRIPTIONS[key];

      wrap.appendChild(cb);
      wrap.appendChild(lab);
      form.appendChild(wrap);
    });

    // Submit → results
    document.getElementById('submitBtn').onclick = () => {
      const user = Array.from(selected);                 // tight keys
      const evalDeds = data.deductions || [];            // tight keys from backend

      const tableBody = document.getElementById('resultsTable');
      tableBody.innerHTML = '';

      LABEL_ORDER.forEach(key => {
        const tr = document.createElement('tr');

        const tdLabel = document.createElement('td');
        tdLabel.className = 'p-2 border-b';
        tdLabel.textContent = LABEL_DESCRIPTIONS[key];
        tr.appendChild(tdLabel);

        const tdUser = document.createElement('td');
        tdUser.className = 'p-2 border-b text-center';
        if (user.includes(key)) tdUser.textContent = '✔';
        tr.appendChild(tdUser);

        const tdEval = document.createElement('td');
        tdEval.className = 'p-2 border-b text-center';
        if (evalDeds.includes(key)) tdEval.textContent = '✔';
        tr.appendChild(tdEval);

        if (user.includes(key) && evalDeds.includes(key)) {
          tr.classList.add('bg-green-50');
        }

        tableBody.appendChild(tr);
      });

      document.getElementById('reasonLine').textContent = data.global_reason || '';

      const resultsEl = document.getElementById('results');
      resultsEl.classList.remove('hidden');
      resultsEl.setAttribute('tabindex', '-1');
      resultsEl.focus();
    };
  }
  loadCase();
  </script>
</body>
</html>
